<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ Workflow: AI Chatbot ‡∏ú‡∏™‡∏≤‡∏ô vTiger ‡πÅ‡∏•‡∏∞ LINE (‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏ó‡∏∏‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* CSS ‡∏´‡∏•‡∏±‡∏Å */
        body {
            font-family: 'Sukhumvit Set', 'Kanit', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f9;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        .header-bg {
            background: linear-gradient(135deg, #00C4CC 0%, #16E65D 100%);
            color: white;
            padding: 30px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .header-bg h1 { margin: 0; font-size: 2.2em; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3); }
        .header-bg p { margin-top: 5px; font-size: 1em; opacity: 0.9; }
        .author-info {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.4);
            font-size: 0.9em;
        }
        .section-heading {
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.6em;
            font-weight: bold;
            border-left: 5px solid #00C4CC;
            padding-left: 15px;
            background-color: #f0f8ff;
            padding: 10px 15px;
            border-radius: 5px;
        }
        .node-card-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .node-card {
            flex: 1 1 calc(50% - 20px);
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            border: 1px solid #e0e0e0;
            min-width: 300px;
        }
        .node-card h3 {
            margin-top: 0;
            color: #007bff;
            display: flex;
            align-items: center;
            font-size: 1.1em;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        .node-card h3 i { margin-right: 10px; font-size: 1.2em; color: #00C4CC; }
        .step-heading {
            font-size: 1em;
            font-weight: bold;
            color: #FF6600;
            margin-top: 15px;
            margin-bottom: 8px;
        }
        .code-block {
            background-color: #272822;
            color: #f8f8f2;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: monospace;
            white-space: pre-wrap;
            margin-top: 5px;
            font-size: 0.9em;
        }
        .explanation {
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-left: 3px solid #007bff;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-bg">
        <h1>üõ†Ô∏è ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ Workflow: AI Chatbot & CRM Integration</h1>
        <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡∏ö‡∏ô LINE ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Data Flow ‡πÅ‡∏•‡∏∞ Logic ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</p>
        <div class="author-info">
            <img src="https://profile.line-scdn.net/0h0eGDNw66b0pqPX4GcyERNRptbCBJTDZYT190LFluMi9eCyscRwgpL1g_OHpWCHhIEghzeAhqYnNmLhgsdGuTfm0NMntWCy0aQ14hrA" 
                 alt="‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ‡∏≠.‡πÅ‡∏ó‡∏ô" 
                 style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; vertical-align: middle; margin-right: 10px; border: 2px solid #fff;">
            <span>‡∏≠.‡πÅ‡∏ó‡∏ô [‡∏ò‡∏µ‡∏£‡∏ä‡∏±‡∏¢ ‡πÇ‡∏â‡∏°‡∏ó‡∏±‡∏û] - Head of Digital Transformation</span>
        </div>
    </div>

    <img src="https://drive.google.com/thumbnail?id=1-9nt1UmpWhfuq9HO3YtAxplFlNfVCq82&sz=w1200" 
         alt="‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Workflow" 
         style="width: 100%; height: auto; border-radius: 8px; margin-bottom: 30px; border: 1px solid #ccc;">

    <div class="section-heading">I. ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Common Path)</div>
    <div class="node-card-container">
        
        <div class="node-card">
            <h3><i class="fas fa-plug"></i> Webhook: tr Lead Data & SetData</h3>
            <p><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LINE ‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</p>
            <p class="step-heading">Step 1: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook</p>
            <div class="explanation">
                ‡∏Å‡∏≥‡∏´‡∏ô‡∏î URL ‡∏ó‡∏µ‡πà LINE Messaging API ‡∏à‡∏∞‡∏¢‡∏¥‡∏á Message Event ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ó‡∏µ‡πà Node ‡∏ô‡∏µ‡πâ ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å (Trigger) ‡∏Ç‡∏≠‡∏á Workflow
            </div>
            <p class="step-heading">Step 2: SetData (‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Token/ID)</p>
            <div class="explanation">
                ‡πÉ‡∏ä‡πâ Node SetData ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏Å‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Workflow ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÄ‡∏ä‡πà‡∏ô Reply Token (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) ‡πÅ‡∏•‡∏∞ Line User ID (‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤)
            </div>
            <p class="step-heading">üí° Data Flow: Output Keys</p>
            <div class="code-block">
                // Reply Token (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Node Line Messaging)<br>
                replyToken: {{ $json.body.events[0].replyToken }}<br><br>
                // User ID (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dedupe ‡πÅ‡∏•‡∏∞ Memory)<br>
                lineUserId: {{ $json.body.events[0].source.userId }}<br><br>
                // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î<br>
                lastMessage: {{ $json.body.events[0].message.text }}
            </div>
        </div>

        <div class="node-card">
            <h3><i class="fas fa-database"></i> PHP Dedupe API (Check Contact) & IF Node</h3>
            <p><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô vTiger ‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</p>
            <p class="step-heading">Step 3: Dedupe API Call</p>
            <div class="explanation">
                ‡∏¢‡∏¥‡∏á POST Request ‡πÑ‡∏õ‡∏¢‡∏±‡∏á vTiger API Endpoint ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á <code>lineUserId</code> ‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞<br>
                Output ‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: <code>status: "success"</code> ‡πÅ‡∏•‡∏∞ <code>action: "NEW_CUSTOMER"</code> ‡∏´‡∏£‡∏∑‡∏≠ <code>"FOUND_CUSTOMER"</code>
            </div>
            <p class="step-heading">Step 4: IF Node Condition</p>
            <div class="explanation">
                ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
            </div>
            <div class="code-block">
                // Condition ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö<br>
                {{ $json.action }} == "NEW_CUSTOMER"
            </div>
            <p><strong>‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á True:</strong> ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Node **Line Regu** (‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô)<br>
            <strong>‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á False:</strong> ‡πÑ‡∏õ‡∏¢‡∏±‡∏á **Gemini Agent - Classify Intent** (‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á)</p>
        </div>

        <div class="node-card">
            <h3><i class="fab fa-line"></i> Line Regu (‡∏™‡πà‡∏á Flex Card ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô)</h3>
            <p><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ‡∏™‡πà‡∏á Flex Message ‡πÄ‡∏ä‡∏¥‡∏ç‡∏ä‡∏ß‡∏ô‡πÑ‡∏õ **‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà** ‡∏ú‡πà‡∏≤‡∏ô LIFF/External URL.</p>
            <p class="step-heading">Step 5: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Reply</p>
            <div class="explanation">
                Node ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ <code>replyToken</code> ‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å Node SetData ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö<br>
                Flex Message JSON ‡∏Ñ‡∏∑‡∏≠ Bubble Card ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤ LIFF/Webform
            </div>
        </div>

        <div class="node-card">
            <h3><i class="fas fa-brain"></i> Gemini Agent - Classify Intent</h3>
            <p><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Intent ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
            <p class="step-heading">Step 6: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Prompt Instruction</p>
            <div class="explanation">
                ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Instruction ‡πÉ‡∏´‡πâ AI ‡∏™‡πà‡∏á JSON Key <code>intent_name</code> ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ ‡πÇ‡∏î‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ **"‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£"** ‡πÅ‡∏•‡∏∞ **"‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"** ‡πÄ‡∏õ‡πá‡∏ô Intent **"PRODUCT_SEARCH"** ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
            </div>
            <div class="code-block">
                // ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á Prompt Instruction<br>
                Intent Mapping:<br>
                - PRODUCT_SEARCH: ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£, ‡∏£‡∏≤‡∏Ñ‡∏≤, ‡πÅ‡∏Ñ‡∏ï‡∏ï‡∏≤‡∏•‡πá‡∏≠‡∏Å, ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£, ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á<br>
                - GENERAL_CHAT: ‡∏Ñ‡∏≥‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢, ‡∏ñ‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠, ‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏•‡πà‡∏ô<br><br>
                Respond ONLY with a JSON object: {"intent_name": "..."}
            </div>
        </div>
    </div>
    
    <hr style="border-top: 1px solid #ccc;">

    <div class="section-heading">II. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Intent ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö (Switch Node)</div>
    <div class="node-card-container">
        
        <div class="node-card">
            <h3><i class="fas fa-sitemap"></i> Switch (Routing)</h3>
            <p><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ‡πÅ‡∏¢‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ï‡∏≤‡∏° Intent ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å Gemini</p>
            <p class="step-heading">Step 7: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Rule</p>
            <div class="explanation">
                ‡πÉ‡∏ä‡πâ Output <code>{{ $json.intent_name }}</code> ‡∏à‡∏≤‡∏Å Classify Intent ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à
            </div>
            <div class="code-block">
                // Rule 1: Product Search (‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á vTiger)<br>
                Condition: {{ $json.intent_name }} == "PRODUCT_SEARCH"<br><br>
                // Rule 2: General Chat / Knowledge Base (‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)<br>
                Condition: {{ $json.intent_name }} != "PRODUCT_SEARCH"
            </div>
        </div>

        <div class="node-card">
            <h3><i class="fas fa-comments"></i> ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á A: General Chat & KB Search</h3>
            <p><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
            <p class="step-heading">Step 8: AI Agent ‡πÅ‡∏•‡∏∞ Memory</p>
            <div class="explanation">
                Node **AI Agent** ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ **Simple Memory** ‡πÄ‡∏û‡∏∑‡πà‡∏≠ **‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤** ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ <code>lineUserId</code> ‡πÄ‡∏õ‡πá‡∏ô Key ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á
            </div>
            <p class="step-heading">Step 9: Search KB (Knowledge Base)</p>
            <div class="explanation">
                ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (General Chat) Flow ‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ (KB) ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ Prepare Reply Data
            </div>
        </div>
        
    </div>

    <hr style="border-top: 1px solid #ccc;">

    <div class="section-heading">III. ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Deep Dive: Product Search)</div>
    <div class="node-card-container">
        
        <div class="node-card">
            <h3><i class="fas fa-calculator"></i> AIProductExtraction1 (Logic Node)</h3>
            <p><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Business Logic **(action_type)** ‡πÅ‡∏•‡∏∞ Clean Data</p>
            <p class="step-heading">Step 11: ‡πÇ‡∏Ñ‡πâ‡∏î JavaScript (Logic)</p>
            <div class="code-block">
                // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å AI/ProductExtraction<br>
                const rawInput = items[0].json; <br>
                const productType = rawInput.product_type ? rawInput.product_type.trim() : '';<br>
                let actionType = productType ? 'get_stock' : 'getAll'; // üí• Logic ‡∏´‡∏•‡∏±‡∏Å<br><br>
                // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Output ‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î<br>
                const vtigerParameters = {<br>
                &nbsp;&nbsp;action_type: actionType,<br>
                &nbsp;&nbsp;product_type: productType,<br>
                &nbsp;&nbsp;brand: rawInput.brand ? rawInput.brand.trim() : '',<br>
                &nbsp;&nbsp;max_price: parseFloat(rawInput.max_price) || 0,<br>
                };<br>
                return [{ json: vtigerParameters }];
            </div>
        </div>

        <div class="node-card">
            <h3><i class="fas fa-search-dollar"></i> vTiger:ProductSearch (API Call)</h3>
            <p><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ‡∏¢‡∏¥‡∏á API POST ‡πÑ‡∏õ‡∏¢‡∏±‡∏á vTiger ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
            <p class="step-heading">Step 12: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Request Body (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)</p>
            <div class="explanation">
                ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Method <strong>POST</strong> ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô JSON Body ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ API ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏î‡πâ<br>
                <strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</strong> ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå PHP API ‡∏ö‡∏ô Server ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ SQL <code>UNION ALL</code> ‡πÅ‡∏•‡∏∞ <code>Unknown column</code>
            </div>
            <div class="code-block">
                // Request Body JSON<br>
                {<br>
                &nbsp;&nbsp;"action_type": "{{ $json.action_type }}",<br>
                &nbsp;&nbsp;"product_type": "{{ $json.product_type }}",<br>
                // ... ‡∏≠‡∏∑‡πà‡∏ô‡πÜ<br>
                }
            </div>
        </div>

        <div class="node-card">
            <h3><i class="fas fa-puzzle-piece"></i> Prepare Reply Data (‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message)</h3>
            <p><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ‡πÅ‡∏õ‡∏•‡∏á Array ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Flex Message Carousel</p>
            <p class="step-heading">Step 13: ‡πÇ‡∏Ñ‡πâ‡∏î JavaScript (Final Output Logic)</p>
            <div class="explanation">
                ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏∞‡∏ß‡∏ô‡∏•‡∏π‡∏õ <code>product_data</code> ‡∏™‡∏£‡πâ‡∏≤‡∏á Bubble Card ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÉ‡∏ö (‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤) ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢ **Contents Object** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Node Line ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö
            </div>
            <div class="code-block">
                // ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á array of Bubble JSON: carouselColumns)<br>
                const flexContentsObject = {<br>
                &nbsp;&nbsp;"type": "carousel",<br>
                &nbsp;&nbsp;"contents": carouselColumns<br>
                };<br>
                // üí• ‡∏™‡πà‡∏á Contents Object ‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß<br>
                return [{ json: { lineReply: flexContentsObject } }];
            </div>
        </div>
        
        <div class="node-card">
            <h3><i class="fab fa-line"></i> Line Card (‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)</h3>
            <p><strong>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong> ‡∏™‡πà‡∏á Flex Message Carousel ‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE User</p>
            <p class="step-heading">Step 14: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Flex Message JSON</p>
            <div class="explanation">
                ‡πÉ‡∏ä‡πâ Expression ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÅ‡∏õ‡∏•‡∏á Object ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô JSON String ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ [Object Object] ‡πÅ‡∏•‡∏∞ Error 400)
            </div>
            <div class="code-block">
                // Expression ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á Flex Message JSON<br>
                {{ JSON.stringify($json.lineReply) }}
            </div>
        </div>
    </div>

    <hr style="border-top: 1px solid #ccc;">

    <div style="text-align: center; margin-top: 30px; font-size: 0.9em; color: #666;">
        <p>‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢ ‡∏≠.‡πÅ‡∏ó‡∏ô (Senior Full-Stack Developer) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î</p>
    </div>
</div>

</body>
</html>