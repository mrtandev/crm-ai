<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 5: Final Project & MVP - AI-Driven Lead Automation</title>
    <!-- Load Tailwind CSS (Master Standard: Day 2) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* * Master Standard CSS & Fonts (Consistent with Day 2/3/4)
         * - ‡πÉ‡∏ä‡πâ Tailwind CSS utility classes ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Responsive Design ‡πÅ‡∏•‡∏∞ Layout
         * - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Custom Fonts ‡πÅ‡∏•‡∏∞ Variables ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Aesthetics
         */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+Thai:wght@100..900&display=swap');
        :root {
            /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏à‡∏≤‡∏Å Day 2: Blue-Indigo Gradient */
            --primary-color: #3b82f6; /* Tailwind Blue-500 */
            --gradient-start: #3b82f6; 
            --gradient-end: #6366f1; /* Tailwind Indigo-500 */
            /* Final Project Accent Color (Green for Success/Deployment) */
            --accent-project: #10b981; /* Tailwind Emerald-500 */
            --bg-light: #f8fafc; /* Tailwind Gray-50 */
        }

        body {
            /* ‡πÉ‡∏ä‡πâ Noto Sans Thai ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ï‡∏≤‡∏° Master Standard */
            font-family: 'Noto Sans Thai', 'Inter', sans-serif;
            background-color: var(--bg-light); 
            line-height: 1.7;
            scroll-behavior: smooth;
        }

        /* Gradient Heading (Standard Aesthetic for H2/H3/H4) */
        .gradient-text {
            background-image: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Card Shadow (Standard Aesthetic for all content blocks) */
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* Section Header (Standard Aesthetic - Left Border Indicator) */
        .section-header {
            border-left: 5px solid var(--primary-color);
            padding-left: 1rem;
            margin-top: 2rem;
            margin-bottom: 1.5rem; /* Standardized spacing */
        }

        /* Status Card Specific Style (for callout boxes) */
        .highlight-card {
            border-left: 5px solid var(--accent-project); /* Project Green for Success */
            background-color: #ecfdf5; /* Emerald-50 */
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .warning-card {
            border-left: 5px solid #f97316; /* Orange-600 for warnings */
            background-color: #fff7ed; /* Orange-50 */
            padding: 1rem;
            border-radius: 0.5rem;
        }

        /* Override Noto Sans Thai font weight for clarity */
        h1, h2, h3, h4 {
            font-weight: 700;
        }
        
        /* Code Block Style (Standard: Slate-800 background) */
        pre {
            background-color: #1e293b; /* Slate-800 */
            color: #f1f5f9; /* Slate-100 */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        code {
            font-family: Consolas, monospace;
            background-color: #334155; /* Slate-700 */
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
            color: #94a3b8; /* Slate-400 */
        }
        .expression-code {
            background-color: #d1fae5; /* Emerald-100 */
            color: #047857; /* Emerald-700 (for AppSheet/N8N Expression) */
            font-weight: 600;
        }
        /* Style for table headers in content sections */
        .content-table th {
            background-color: #f3f4f6;
        }
        .flow-node {
            background-color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .arrow {
            color: var(--accent-project);
        }

    </style>
    <script>
        // * Lucide Icons (Consistent with Master Handbook Series)
        const renderIcon = (name, className = 'w-5 h-5') => {
            const icons = {
                'cpu': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><rect width="16" height="16" x="4" y="4" rx="2"/><path d="M15 9h1a2 2 0 0 1 2 2v1"/><path d="M9 15h-1a2 2 0 0 0 -2 2v1"/><path d="M15 15v1a2 2 0 0 1 -2 2h-1"/><path d="M9 9v-1a2 2 0 0 0 -2 -2h-1"/></svg>`,
                'zap': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
                'database': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 12a9 3 0 0 0 18 0"/><path d="M3 19a9 3 0 0 0 18 0"/><path d="M3 5v14"/></svg>`,
                'send': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><line x1="22" x2="11" y1="2" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>`,
                'refresh-cw': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1 -2.12 -9.36l3.33 -3.33"/></svg>`,
                'target': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>`,
                'check-circle': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M22 11.08V12a10 10 0 1 1 -5.93 -9.14"/><path d="M9 11l2 2l4 -4"/></svg>`,
                'link': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M10 13a5 5 0 0 0 7.54.54l3 -3a5 5 0 0 0 -7.07 -7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0 -7.54 -.54l-3 3a5 5 0 0 0 7.07 7.07l1.71 -1.71"/></svg>`,
                'trending-up': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>`,
                'code': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>`,
                'mail': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7l-10 7l-10 -7"/></svg>`,
                'split': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M12 21v-14"/><path d="M10 5l2 -2l2 2"/><path d="M12 15h-4"/><path d="M12 15l-4 4"/><path d="M12 15l-4 -4"/><path d="M12 15h4"/><path d="M12 15l4 4"/><path d="M12 15l4 -4"/></svg>`,
            };
            return icons[name] || '';
        };
        
        window.onload = () => {
             console.log("Day 5 Final Project Handbook Loaded (Content Depth Target: >= 1000 lines).");
        };

    </script>
</head>
<body class="min-h-screen">
    <!-- Message Box for Alerts/Confirmations (Standard) -->
    <div id="messageBox" class="fixed top-4 right-4 z-50 w-full max-w-sm"></div>

    <!-- Header Section (Consistent with Master Handbook - Tailwind Structure) -->
    <header class="bg-white card-shadow sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="text-3xl font-extrabold tracking-tight">
                        <span class="gradient-text">AI Automation & Data Integration Master</span>
                    </div>
                </div>
                <div class="mt-2 md:mt-0 text-right text-sm text-gray-600">
                    Day 5: Final Project & MVP üéØ ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Instructor Information Card (Consistent with Day 2/3/4) -->
        <div class="bg-white p-6 rounded-xl card-shadow mb-8 border-t-4 border-indigo-500">
            <div class="flex items-center space-x-4">
                <img src="https://profile.line-scdn.net/0h0eGDNw66b0pqPX4GcyERNRptbCBJTDZYT190LFluMi9eCyscRwgpL1g_OHpWCHhIEghzeAhqYnNmLhgsdGuTfm0NMntWCy0aQ14hrA" 
                     onerror="this.onerror=null;this.src='https://placehold.co/80x80/6366f1/ffffff?text=‡∏≠.‡πÅ‡∏ó‡∏ô'"
                     alt="‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡πÅ‡∏ó‡∏ô ‡∏ò‡∏µ‡∏£‡∏ä‡∏±‡∏¢ ‡πÇ‡∏â‡∏°‡∏ó‡∏±‡∏û" class="w-20 h-20 rounded-full object-cover ring-2 ring-indigo-500">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">‡∏≠.‡πÅ‡∏ó‡∏ô <span class="text-indigo-600">[‡∏ò‡∏µ‡∏£‡∏ä‡∏±‡∏¢ ‡πÇ‡∏â‡∏°‡∏ó‡∏±‡∏û]</span></h2>
                    <p class="text-base text-gray-500">Head of Digital Transformation</p>
                    <p class="text-sm text-gray-600 mt-1">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Day 5: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏≠‡∏á‡∏Ñ‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á **Masterpiece MVP**!</p>
                </div>
            </div>
        </div>

        <!-- Introduction Card -->
        <div class="bg-white p-6 rounded-xl card-shadow mb-8 highlight-card">
            <div class="flex items-center space-x-3 mb-4 border-b pb-3 border-emerald-200">
                <script>document.write(renderIcon('target', 'w-7 h-7 inline-block text-emerald-500 mr-2'));</script>
                <h2 class="text-3xl font-bold gradient-text">‡∏ö‡∏ó‡∏ô‡∏≥: AI-Driven Lead Automation MVP (Project Synthesis)</h2>
            </div>
            
            <p class="text-gray-700 leading-relaxed">
                Final Project ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö **AI-Driven Lead Qualification and Follow-up MVP** ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:
                <ul class="list-disc list-inside ml-4 mt-2 space-y-1 font-semibold text-emerald-700">
                    <li>‚úÖ ‡∏£‡∏±‡∏ö Leads ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÅ‡∏ö‡∏ö Real-Time ‡∏à‡∏≤‡∏Å‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ (AppSheet Webhook)</li>
                    <li>‚úÖ ‡πÉ‡∏ä‡πâ **AI (Gemini)** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ (Lead Scoring) ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î Tier</li>
                    <li>‚úÖ ‡πÅ‡∏¢‡∏Å Leads ‡πÑ‡∏õ‡∏¢‡∏±‡∏á **CRM** ‡∏´‡∏£‡∏∑‡∏≠ **Nurturing Email** ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Decision Gate)</li>
                    <li>‚úÖ **‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô** ‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏°‡∏Ç‡∏≠‡∏á API ‡∏î‡πâ‡∏ß‡∏¢ **Exponential Backoff** ‡πÅ‡∏•‡∏∞ **DLQ** (Resilience Logic)</li>
                    <li>‚úÖ **‡∏õ‡∏¥‡∏î Loop** ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á **Google Sheets** (Post-Processing)</li>
                </ul>
            </p>
        </div>
        <!-- *************************************************************** -->

        <!-- SECTION 6.1: PROJECT ARCHITECTURE AND DATA FLOW -->
        <div class="bg-white p-6 rounded-xl card-shadow mt-8">
            <div class="section-header border-blue-500 mb-6">
                <h2 class="text-3xl font-bold gradient-text">
                    <script>document.write(renderIcon('link', 'w-7 h-7 inline-block text-blue-500 mr-2'));</script>
                    6.1 Project Architecture: ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </h2>
            </div>
            
            <p class="text-gray-700 leading-relaxed mb-4">
                Flow ‡∏Ç‡∏≠‡∏á Final Project ‡∏ô‡∏µ‡πâ‡πÅ‡∏ö‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 3 Layers ‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ **Transaction ID** ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏Å‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô (Day 2/4 Principle)
            </p>

            <!-- Flow Diagram (Conceptual Synthesis) -->
            <h4 class="text-xl font-medium mt-6 text-indigo-700">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° (Full Stack Flow)</h4>
            <div class="flex flex-col items-center justify-center p-6 bg-gray-100 rounded-xl my-4 card-shadow space-y-3">
                <div class="flow-node bg-yellow-100 text-yellow-800 font-bold">1. Input Layer (AppSheet Form / Webhook)</div>
                <div class="arrow text-3xl font-bold">HTTPS POST &darr;</div>
                <div class="flow-node bg-pink-100 text-pink-800 font-bold">2. N8N Controller Flow (HMAC & 202 Async)</div>
                <div class="arrow text-3xl font-bold">HTTP Call &darr;</div>
                <div class="flow-node bg-blue-100 text-blue-800 font-bold">3. N8N Worker Flow (Pre-Process & AI & Decision)</div>
                <div class="arrow text-3xl font-bold">If/Switch &darr;</div>
                
                <div class="flex justify-between w-full max-w-lg mt-2 space-x-2">
                    <div class="flex flex-col items-center w-1/3">
                        <div class="flow-node bg-red-100 text-red-800 text-sm">Path A: CRM + Backoff/DLQ (High Priority)</div>
                    </div>
                    <div class="flex flex-col items-center w-1/3">
                        <div class="flow-node bg-teal-100 text-teal-800 text-sm">Path B: Nurturing Email (Medium Priority)</div>
                    </div>
                    <div class="flex flex-col items-center w-1/3">
                        <div class="flow-node bg-gray-200 text-gray-700 text-sm">Path C: Log Only (Low Priority)</div>
                    </div>
                </div>

                <div class="arrow text-3xl font-bold">Merge Path &darr;</div>
                <div class="flow-node bg-emerald-100 text-emerald-800 font-bold">4. Post-Processing (Update Sheets Status)</div>
            </div>

            <!-- 6.1.2 Data Model Review -->
            <div class="section-header border-blue-500 mb-6 mt-8">
                <h3 class="text-2xl font-bold gradient-text">6.1.2 Data Model Review (Day 1 Principle)</h3>
            </div>
            <p class="text-gray-700 leading-relaxed mb-4">
                ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ Google Sheet 3 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á (3NF) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤ Data Integrity:
            </p>
            <table class="min-w-full divide-y divide-gray-200 mt-4 content-table text-sm">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-3 py-2 text-left">Sheet Name</th>
                        <th class="px-3 py-2 text-left">Primary Role</th>
                        <th class="px-3 py-2 text-left">Key Columns</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200 text-sm">
                    <tr><td class="py-2"><code class="expression-code">Leads</code></td><td class="py-2">‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (Timestamp, Email, Phone, Industry)</td><td class="py-2"><code class="expression-code">Lead ID</code> (Unique ID), <code class="expression-code">Status</code></td></tr>
                    <tr><td class="py-2"><code class="expression-code">DLQ_Log</code></td><td class="py-2">‡∏Å‡∏±‡∏Å‡πÄ‡∏Å‡πá‡∏ö Payload ‡∏ó‡∏µ‡πà N8N ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡∏ñ‡∏≤‡∏ß‡∏£ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Re-queue)</td><td class="py-2"><code class="expression-code">Log ID</code> (Unique ID), <code class="expression-code">Failed JSON</code></td></tr>
                    <tr><td class="py-2"><code class="expression-code">Users</code></td><td class="py-2">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Role/Sales Rep Assignment (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠/‡∏≠‡∏µ‡πÄ‡∏°‡∏•)</td><td class="py-2"><code class="expression-code">Email</code> (Primary Key), <code class="expression-code">Role</code></td></tr>
                </tbody>
            </table>
        </div>

        <!-- *************************************************************** -->
        <!-- SECTION 6.2: APPSHEET MVP SETUP (FRONT-END TRIGGER) -->
        <div class="bg-white p-6 rounded-xl card-shadow mt-8">
            <div class="section-header border-blue-500 mb-6">
                <h2 class="text-3xl font-bold gradient-text">
                    <script>document.write(renderIcon('zap', 'w-7 h-7 inline-block text-blue-500 mr-2'));</script>
                    6.2 AppSheet MVP: Webhook Trigger ‡πÅ‡∏•‡∏∞ Payload Configuration
                </h2>
            </div>
            <p class="text-gray-700 leading-relaxed mb-4">
                MVP ‡∏Ç‡∏≠‡∏á AppSheet ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á Payload ‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÑ‡∏õ‡∏¢‡∏±‡∏á N8N ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ú‡πà‡∏≤‡∏ô **Webhook Action**
            </p>

            <!-- Step 6.2.1: AppSheet Automation Bot Setup -->
            <h3 class="text-2xl font-semibold mt-6 text-gray-800 flex items-center space-x-2 border-b pb-2">
                <script>document.write(renderIcon('code', 'w-6 h-6 text-yellow-600'));</script>
                <span>Step 1: ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î Event ‡πÅ‡∏•‡∏∞ Process ‡πÉ‡∏ô AppSheet Bot</span>
            </h3>
            <ol class="list-decimal list-inside ml-4 mt-2 space-y-1 text-gray-700">
                <li>**Event:** <code class="expression-code">Data Change: ADD</code> (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á <code class="expression-code">Leads</code>)</li>
                <li>**Condition:** <code class="expression-code">ISBLANK([N8N_Status])</code> (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÇ‡∏î‡∏¢ N8N)</li>
                <li>**Step 1:** <code class="expression-code">Call a webhook</code> (Action Type)</li>
            </ol>
            
            <h4 class="text-xl font-medium mt-6 text-indigo-700">JSON Payload Template (Day 3 Review)</h4>
            <p class="mt-2 text-gray-700 leading-relaxed">
                ‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î **JSON Body Template** ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà N8N ‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á
            </p>
            <pre class="text-sm">
// Webhook Payload Template (AppSheet)
{
  "transaction_id": "<<[Lead ID]>>", // PRIMARY KEY
  "payload_source": "AppSheet_Lead_App",
  "client_ip": "<<CONTEXT("Client IP")>>", // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Context ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Fraud Check
  "raw_data": {
    "email": "<<[Email]>>",
    "phone": "<<[Phone]>>",
    "industry": "<<[Industry]>>",
    "budget": "<<[Budget]>>"
  },
  "metadata": {
    "timestamp": "<<NOW()>>", // Timestamp ‡∏à‡∏≤‡∏Å AppSheet
    "user_email": "<<USEREMAIL()>>"
  }
}
            </pre>
            <p class="text-gray-700 leading-relaxed mt-3">
                **Master Tip:** ‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏° <code class="expression-code">metadata</code> ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ N8N ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Log ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏ä‡∏¥‡∏á Audit ‡πÑ‡∏î‡πâ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å
            </p>
        </div>
        
        <!-- *************************************************************** -->
        <!-- SECTION 6.3: N8N MASTER FLOW IMPLEMENTATION (BACKEND) -->
        <div class="bg-white p-6 rounded-xl card-shadow mt-8">
            <div class="section-header border-blue-500 mb-6">
                <h2 class="text-3xl font-bold gradient-text">
                    <script>document.write(renderIcon('repeat', 'w-7 h-7 inline-block text-blue-500 mr-2'));</script>
                    6.3 N8N Master Flow: Resilience and AI Orchestration
                </h2>
            </div>
            <p class="text-gray-700 leading-relaxed mb-4">
                Flow ‡πÉ‡∏ô N8N ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô **Controller Flow** (‡∏£‡∏±‡∏ö Webhook, ‡∏ï‡∏≠‡∏ö 202, Call Worker) ‡πÅ‡∏•‡∏∞ **Worker Flow** (Logic ‡∏´‡∏•‡∏±‡∏Å)
            </p>

            <!-- Step 6.3.1: Controller Flow (202 Accepted) -->
            <h3 class="text-2xl font-semibold mt-6 text-gray-800 flex items-center space-x-2 border-b pb-2">
                <script>document.write(renderIcon('zap', 'w-6 h-6 text-green-600'));</script>
                <span>Step 2: Controller Flow (HMAC ‡πÅ‡∏•‡∏∞ HTTP 202)</span>
            </h3>
            <p class="mt-3 text-gray-700 leading-relaxed">
                Controller Flow ‡∏£‡∏±‡∏ö Webhook ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î Timeout
            </p>
            <pre class="text-sm">
// Controller Flow: Node 4 - HTTP Request Node (Call Worker)
// Flow ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÅ‡∏°‡πâ Worker Flow ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ô‡∏≤‡∏ô

URL: <code class="expression-code">Webhook URL ‡∏Ç‡∏≠‡∏á Worker Flow</code>
Body: <code class="expression-code">{{ JSON.stringify($json) }}</code>
Method: <code class="expression-code">POST</code>
Header: <code class="expression-code">Content-Type: application/json</code>
            </pre>

            <!-- Step 6.3.2: Worker Flow Logic (AI Scoring) -->
            <div class="section-header border-blue-500 mb-6 mt-8">
                <h3 class="text-2xl font-bold gradient-text">6.3.2 Worker Flow Logic: AI Lead Scoring Agent (Pre-Processing Master)</h3>
            </div>
            <p class="text-gray-700 leading-relaxed mb-4">
                ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ AI ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
            </p>

            <h4 class="text-xl font-medium mt-6 text-indigo-700">Code Node: Data Pre-processing (Master Validation & Correlation)</h4>
            <pre class="text-sm">
// Code Node: 6.3.2 - Data Pre-processing (Master Level)
const items = $input.json;
const REQUIRED_FIELDS = ['email', 'industry', 'budget'];
const outputItems = [];

for (const item of items) {
    const rawData = item.json.raw_data;
    let errors = [];
    
    // 1. **Data Validation:** Check for critical missing fields
    for (const field of REQUIRED_FIELDS) {
        if (!rawData[field] || rawData[field].toString().trim() === '') {
            errors.push(`Missing Required Field: ${field}`);
        }
    }
    
    // 2. **Correlation ID:** Generate or use Transaction ID for tracking
    item.json.correlation_id = item.json.transaction_id || crypto.randomUUID();
    item.json.cleaned_email = rawData.email ? rawData.email.toLowerCase().trim() : null;

    if (errors.length > 0) {
        // Flag item for error path (DLQ for Invalid Input)
        item.json.validation_status = 'INVALID_INPUT';
        item.json.validation_errors = errors;
        outputItems.push(item);
    } else {
        // Ready for AI Scoring
        item.json.validation_status = 'VALID';
        item.json.prompt_input = `Customer Email: ${item.json.cleaned_email}, Industry: ${rawData.industry}, Estimated Budget: ${rawData.budget} USD.`;
        outputItems.push(item);
    }
}
return outputItems;
            </pre>
            
            <h4 class="text-xl font-medium mt-6 text-indigo-700">AI Node: Structured Output (Day 4 Core)</h4>
            <p class="mt-2 text-gray-700 leading-relaxed">
                ‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î **JSON Schema** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥:
            </p>
            <pre class="text-sm">
// LLM Prompt + Schema (N8N Configuration)
System Instruction: "Act as a Senior Sales Analyst. Score the lead from 1 to 10 and assign a Tier (A, B, C) based on budget and industry fit. Provide output in JSON format ONLY."

JSON Schema:
{
  "type": "object",
  "properties": {
    "score": { "type": "number", "minimum": 1, "maximum": 10 },
    "tier": { "type": "string", "enum": ["A", "B", "C"] },
    "sales_assignment": { "type": "string", "description": "‡∏ä‡∏∑‡πà‡∏≠ Sales Rep ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° (e.g., 'Sam' for High-Tech, 'Jane' for Retail)" }
  },
  "required": ["score", "tier"]
}
            </pre>
        </div>
        
        <!-- *************************************************************** -->
        <!-- SECTION 6.4: RESILIENCE & DECISION GATE -->
        <div class="bg-white p-6 rounded-xl card-shadow mt-8">
            <div class="section-header border-blue-500 mb-6">
                <h2 class="text-3xl font-bold gradient-text">
                    <script>document.write(renderIcon('trending-up', 'w-7 h-7 inline-block text-blue-500 mr-2'));</script>
                    6.4 Resilience Logic ‡πÅ‡∏•‡∏∞ Decision Gates
                </h2>
            </div>

            <!-- Step 6.4.1: Decision Gate -->
            <h3 class="text-2xl font-semibold mt-6 text-gray-800 flex items-center space-x-2 border-b pb-2">
                <script>document.write(renderIcon('cpu', 'w-6 h-6 text-yellow-600'));</script>
                <span>Step 3: Decision Gate (If Node) ‡∏ï‡∏≤‡∏° AI Score</span>
            </h3>
            <p class="mt-3 text-gray-700 leading-relaxed">
                ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å AI Node ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÅ‡∏¢‡∏Å Flow
            </p>
            <table class="min-w-full divide-y divide-gray-200 mt-4 content-table text-sm">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-3 py-2 text-left">Condition</th>
                        <th class="px-3 py-2 text-left">Action Path</th>
                        <th class="px-3 py-2 text-left">Destination</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200 text-sm">
                    <tr><td class="py-2"><code class="expression-code">{{ $node['AI Node'].json['tier'] }} == "A"</code></td><td class="py-2">Critical Path: ‡∏™‡∏£‡πâ‡∏≤‡∏á Record ‡πÉ‡∏ô CRM + Alert Slack</td><td class="py-2">API 1: CRM (Target), API 2: Slack</td></tr>
                    <tr><td class="py-2"><code class="expression-code">{{ $node['AI Node'].json['tier'] }} == "B"</code></td><td class="py-2">Standard Path: ‡∏™‡∏£‡πâ‡∏≤‡∏á Record ‡πÉ‡∏ô CRM (Low Priority) + Email Nurturing</td><td class="py-2">API 1: CRM (Target), API 2: SendGrid</td></tr>
                    <tr><td class="py-2">Else (Tier C)</td><td class="py-2">Nurturing Only: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheet (Nurturing List)</td><td class="py-2">Google Sheets Node</td></tr>
                </tbody>
            </table>

            <!-- Step 6.4.2: Resilience for Critical Path -->
            <h3 class="text-2xl font-semibold mt-6 text-gray-800 flex items-center space-x-2 border-b pb-2">
                <script>document.write(renderIcon('refresh-cw', 'w-6 h-6 text-red-600'));</script>
                <span>Step 4: Exponential Backoff (Try/Catch) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Critical API Call</span>
            </h3>
            <p class="mt-3 text-gray-700 leading-relaxed">
                ‡πÉ‡∏ä‡πâ Try/Catch ‡πÅ‡∏•‡∏∞ Backoff Logic ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ CRM
            </p>
            
            <pre class="text-sm">
// Code Node: 6.4.2 - Backoff Logic (‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥‡∏à‡∏≤‡∏Å Day 4)
// This code is placed in the Catch Block of the CRM API Call.

const MAX_RETRIES = 5; 
const BASE_DELAY_MS = 2000; 

for (const item of $input.json) {
    const currentAttempt = item.json.retryAttempt || 0;
    
    if (currentAttempt >= MAX_RETRIES) {
        // FAIL PERMANENTLY: ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ DLQ
        item.json.dlq_status = 'PERMANENT_FAIL';
        item.json.dlq_reason = item.error?.message || 'Max retries exceeded. API Error Code: ' + item.error?.code;
        item.json.sendToDLQ = true; 
    } else {
        // RETRY: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏ô‡πà‡∏ß‡∏á 2^n * Base Delay
        const calculatedDelay = Math.pow(2, currentAttempt) * BASE_DELAY_MS;
        item.json.backoffDelay = Math.min(calculatedDelay, 300000); 
        item.json.retryAttempt = currentAttempt + 1;
        item.json.sendToDLQ = false;
    }
}
return $input.json; 
            </pre>
            
            <div class="warning-card p-4 rounded-lg my-4">
                <h4 class="font-bold text-orange-800">üö® 6.4.3 DLQ Logging Worker Flow (Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)</h4>
                <p class="text-orange-700 text-sm mt-1">
                    DLQ Worker Flow ‡∏à‡∏∞‡∏£‡∏±‡∏ö Payload ‡∏ó‡∏µ‡πà‡∏°‡∏µ <code class="expression-code">sendToDLQ: true</code> ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á Log ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                </p>
                <pre class="text-sm">
// DLQ Worker Flow: Node 2 - Code Node (Prepare Data for Logging)
const items = $input.json;
const logEntries = [];

for (const item of items) {
    // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏•‡∏∞ Error context
    const correlationId = item.json.correlation_id;
    const originalPayload = JSON.stringify(item.json);
    const failureReason = item.json.dlq_reason || 'Unknown Error';
    const retryCount = item.json.retryAttempt;

    // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Log Entry ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Google Sheets (DLQ_Log)
    logEntries.push({
        json: {
            Log_ID: correlationId,
            Failure_Type: 'API_MAX_RETRY',
            Error_Message: failureReason,
            Original_Source: item.json.payload_source,
            Original_Payload_JSON: originalPayload, // ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Å‡πâ‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Re-queue
            Retry_Count_Final: retryCount,
            Manual_Status: "Pending Review",
            Created_At: new Date().toISOString()
        }
    });
}
return logEntries; 
// ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ Google Sheets Node (Append: DLQ_Log)
                </pre>
            </div>
            
            <h3 class="text-2xl font-semibold mt-6 text-gray-800 flex items-center space-x-2 border-b pb-2">
                <script>document.write(renderIcon('refresh-cw', 'w-6 h-6 text-yellow-600'));</script>
                <span>Step 5: DLQ Re-queue Scheduler (Flow ‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡∏°‡∏≤)</span>
            </h3>
            <p class="mt-3 text-gray-700 leading-relaxed">
                Flow ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (Scheduler) ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å 30 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Leads ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ Flow ‡∏´‡∏•‡∏±‡∏Å
            </p>
            <pre class="text-sm">
// Re-queue Scheduler Flow: Node 3 - Code Node (JSON Parse & Re-send)
const items = $input.json; // Input ‡∏°‡∏≤‡∏à‡∏≤‡∏Å Google Sheets Node (Read: WHERE Manual_Status = 'Ready for Requeue')
const payloadToRequeue = [];
const WORKER_WEBHOOK_URL = $env.WORKER_WEBHOOK_URL; 

for (const item of items) {
    const originalPayloadString = item.json.Original_Payload_JSON; 
    
    try {
        const parsedPayload = JSON.parse(originalPayloadString);
        
        // **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡∏Å‡πà‡∏≠‡∏ô Re-queue ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ DLQ/Retry ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Payload ‡πÄ‡∏Å‡πà‡∏≤
        delete parsedPayload.dlq_status;
        delete parsedPayload.dlq_reason;
        delete parsedPayload.retryAttempt;
        delete parsedPayload.sendToDLQ;
        
        // 1. **Re-send Logic:** ‡πÉ‡∏ä‡πâ HTTP Request Node (POST) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏¥‡∏á parsedPayload ‡πÑ‡∏õ‡∏¢‡∏±‡∏á WORKER_WEBHOOK_URL
        payloadToRequeue.push({ json: parsedPayload }); 
        
    } catch (e) {
        console.error(`DLQ JSON Parse Error for ID ${item.json.Log_ID}: ${e.message}`);
        // ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ Logic ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤ JSON Parse ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡πÉ‡∏ô Re-queue
    }
}
return payloadToRequeue; 
            </pre>
        </div>

        <!-- *************************************************************** -->
        <!-- SECTION 6.6: ADVANCED CODE NODE PATTERNS (NEW EXPANSION) -->
        <div class="bg-white p-6 rounded-xl card-shadow mt-8">
            <div class="section-header border-blue-500 mb-6">
                <h2 class="text-3xl font-bold gradient-text">
                    <script>document.write(renderIcon('code', 'w-7 h-7 inline-block text-blue-500 mr-2'));</script>
                    6.6 Advanced Code Node Patterns: Marketing Action
                </h2>
            </div>
            <p class="text-gray-700 leading-relaxed mb-4">
                ‡πÉ‡∏ô Path B (Email Nurturing) ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ Code Node ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏≤‡∏ç‡∏â‡∏•‡∏≤‡∏î‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö Action ‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î
            </p>

            <!-- Step 6.6.1: Dynamic HTML Template Rendering -->
            <h3 class="text-2xl font-semibold mt-6 text-gray-800 flex items-center space-x-2 border-b pb-2">
                <script>document.write(renderIcon('mail', 'w-6 h-6 text-yellow-600'));</script>
                <span>Step 6: Dynamic HTML Template Rendering (Email Body)</span>
            </h3>
            <p class="mt-3 text-gray-700 leading-relaxed">
                ‡πÉ‡∏ä‡πâ Template Literal ‡πÉ‡∏ô JavaScript ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á HTML Body ‡∏ó‡∏µ‡πà Personalize ‡πÇ‡∏î‡∏¢‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà Clean ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞ AI Score
            </p>
            <pre class="text-sm">
// Code Node: 6.6.1 - Email Template Generation
const items = $input.json;

for (const item of items) {
    const name = item.json.raw_data.name || '‡∏Ñ‡∏∏‡∏ì‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤';
    const tier = item.json.ai_result.tier;
    const score = item.json.ai_result.score;
    
    // HTML Template (‡πÉ‡∏ä‡πâ Template Literal `...` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡∏£‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£)
    const emailBody = `
        &lt;h1 style="color: #3b82f6;">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${name} &lt;/h1>
        &lt;p>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤! ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß (AI Score: ${score}/10)
        ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö **Tier ${tier}**&lt;/p>
        &lt;div style="background: #f0f9ff; padding: 15px; border-radius: 8px;">
            &lt;p>‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏µ‡∏° Nurturing ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏≠‡∏ö Content ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
            ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô ${item.json.raw_data.industry} &lt;/p>
        &lt;/div>
        &lt;p>‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏∑‡∏≠,&lt;br>‡∏ó‡∏µ‡∏° AI Automation &lt;/p>
    `;
    item.json.email_html_body = emailBody;
}
return items; // Output ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà SendGrid/Email Node
            </pre>

            <!-- Step 6.6.2: A/B Test Logic for Email Subject Line -->
            <h3 class="text-2xl font-semibold mt-6 text-gray-800 flex items-center space-x-2 border-b pb-2">
                <script>document.write(renderIcon('split', 'w-6 h-6 text-purple-600'));</script>
                <span>Step 7: A/B Testing Logic (Random Split)</span>
            </h3>
            <p class="mt-3 text-gray-700 leading-relaxed">
                ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö Subject Line ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏• Nurturing ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏î‡πâ‡∏ß‡∏¢ Code Node ‡πÅ‡∏•‡∏∞ **Split In Batches Node**
            </p>
            <pre class="text-sm">
// Code Node: 6.6.2 - A/B Test Split (50/50 Random)
const items = $input.json;
const outputA = [];
const outputB = [];

for (const item of items) {
    // 1. Randomly assign to Group A or B
    const isGroupA = Math.random() < 0.5; // 50% probability
    
    if (isGroupA) {
        item.json.subject_line = `A: Leads Tier ${item.json.ai_result.tier} - ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞`;
        item.json.ab_test_group = 'A';
        outputA.push(item);
    } else {
        item.json.subject_line = `B: [‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤] ‡∏°‡∏µ Content ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏£‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà`;
        item.json.ab_test_group = 'B';
        outputB.push(item);
    }
}

// **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡∏™‡πà‡∏á Output ‡πÄ‡∏õ‡πá‡∏ô 2 Sets ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ Split In Batches Node ‡∏ï‡πà‡∏≠‡πÑ‡∏õ
return [outputA, outputB];
            </pre>
            <p class="text-gray-700 leading-relaxed mt-3">
                **Flow Logic:** Output Index 0 (<code class="expression-code">A</code>) ‡πÅ‡∏•‡∏∞ Index 1 (<code class="expression-code">B</code>) ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á Node ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏• 2 ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏î Conversion Rate ‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
            </p>
        </div>

        <!-- *************************************************************** -->
        <!-- SECTION 6.7: PRODUCTION MONITORING AND ALERTING (EXPANDED) -->
        <div class="bg-white p-6 rounded-xl card-shadow mt-8">
            <div class="section-header border-blue-500 mb-6">
                <h2 class="text-3xl font-bold gradient-text">
                    <script>document.write(renderIcon('bell', 'w-7 h-7 inline-block text-blue-500 mr-2'));</script>
                    6.7 Production Monitoring & Alerting (Master Alert Code)
                </h2>
            </div>
            <p class="text-gray-700 leading-relaxed mb-4">
                ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÅ‡∏•‡∏∞‡∏°‡∏µ **Context** ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ Execution ID ‡πÅ‡∏•‡∏∞ Link ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Log)
            </p>

            <!-- Step 6.7.1: Dynamic Alert Formatting -->
            <h3 class="text-2xl font-semibold mt-6 text-gray-800 flex items-center space-x-2 border-b pb-2">
                <script>document.write(renderIcon('code', 'w-6 h-6 text-yellow-600'));</script>
                <span>Step 8: Code Node: Dynamic Alert Message (Slack/Line)</span>
            </h3>
            <p class="mt-3 text-gray-700 leading-relaxed">
                ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Rich Text/Markdown Message ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏ô Slack Node (‡∏´‡∏£‡∏∑‡∏≠ Line Notify Node) ‡πÉ‡∏ô Catch Block
            </p>
            <pre class="text-sm">
// Code Node: 6.7.1 - Rich Alert Formatting for Slack
const items = $input.json; // Input ‡∏°‡∏≤‡∏à‡∏≤‡∏Å Catch Block ‡∏´‡∏£‡∏∑‡∏≠ DLQ Worker
const N8N_HOST = $env.N8N_BASE_URL; // e.g., https://n8n.mycompany.com
const WORKFLOW_ID = $env.N8N_WORKFLOW_ID; // ‡∏î‡∏∂‡∏á ID Workflow ‡∏à‡∏≤‡∏Å Environment Variable

for (const item of items) {
    const errorDetails = item.json.dlq_reason || 'API Call Failed (No detailed error)';
    const correlationId = item.json.correlation_id || 'N/A';
    const source = item.json.payload_source || 'Unknown';
    const tier = item.json.ai_result?.tier || 'N/A';
    const executionId = $execution.id; // ‡πÉ‡∏ä‡πâ Global Execution ID ‡∏Ç‡∏≠‡∏á N8N

    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Dynamic Link ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Log ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    const logUrl = `${N8N_HOST}/workflow/${WORKFLOW_ID}/execution/${executionId}`;
    
    // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Slack Markdown Message
    const slackMessage = `
*üö® CRITICAL ERROR: DLQ Triggered in Lead Flow*
---
*Workflow:* Day 5: AI-Driven Lead Automation (ID: ${WORKFLOW_ID})
*Execution ID:* <${logUrl}|${executionId}>
*Correlation ID:* ${correlationId}
*Error Reason:* ${errorDetails}
*Lead Tier:* ${tier}
*Source:* ${source}
---
*ACTION:* ‡∏ó‡∏µ‡∏° Ops ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Log ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ *Re-queue* ‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á DLQ_Log
`;
    item.json.slack_alert_message = slackMessage;
}
return items;
            </pre>
            <p class="text-gray-700 leading-relaxed mt-3">
                **Master Tip:** ‡∏Å‡∏≤‡∏£‡πÅ‡∏ó‡∏£‡∏Å <code class="expression-code">$execution.id</code> ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Environment Variable <code class="expression-code">$env.N8N_BASE_URL</code> ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Alert ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô **Actionable Alert** ‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà Log ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            </p>
        </div>

        <!-- *************************************************************** -->
        <!-- SECTION 6.5: FINAL ACTIONS AND DEPLOYMENT -->
        <div class="bg-white p-6 rounded-xl card-shadow mt-8">
            <div class="section-header border-blue-500 mb-6">
                <h2 class="text-3xl font-bold gradient-text">
                    <script>document.write(renderIcon('send', 'w-7 h-7 inline-block text-blue-500 mr-2'));</script>
                    6.5 Final Actions: Post-Processing ‡πÅ‡∏•‡∏∞ Production Deployment
                </h2>
            </div>

            <!-- Step 6.5.1: Sales Assignment (Dynamic) -->
            <h3 class="text-2xl font-semibold mt-6 text-gray-800 flex items-center space-x-2 border-b pb-2">
                <script>document.write(renderIcon('database', 'w-6 h-6 text-yellow-600'));</script>
                <span>Step 9: Dynamic Sales Rep Assignment (LookUp Master Code)</span>
            </h3>
            <p class="mt-3 text-gray-700 leading-relaxed">
                ‡πÉ‡∏ä‡πâ Code Node ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ **LookUp** ‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Sales Rep (‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á <code class="expression-code">Users</code>) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á Sales Rep ‡∏ó‡∏µ‡πà AI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (<code class="expression-code">sales_assignment</code>)
            </p>
            <pre class="text-sm">
// Code Node: 6.5.1 - Dynamic Sales Rep LookUp
const items = $input.json;
const usersData = $node['Google Sheets: Read Users'].json; // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Users ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô Node ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
const DEFAULT_SALES_EMAIL = 'support@company.com'; 

for (const item of items) {
    const aiAssignedName = item.json.ai_result.sales_assignment;
    
    // 1. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Sales Rep ‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà AI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
    const assignedUser = usersData.find(user => 
        user.Name === aiAssignedName
    );

    let assignedEmail;

    if (assignedUser) {
        // 2. ‡∏ñ‡πâ‡∏≤‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏±‡πâ‡∏ô
        assignedEmail = assignedUser.Email;
    } else {
        // 3. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö ‡∏´‡∏£‡∏∑‡∏≠ AI ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Fallback Email
        console.warn(`AI suggested unknown Sales Rep: ${aiAssignedName}. Falling back to default.`);
        assignedEmail = DEFAULT_SALES_EMAIL;
    }
    
    // 4. ‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Item
    item.json.assigned_email = assignedEmail; 
}

return items;
            </pre>


            <!-- Step 6.5.2: Post-Processing -->
            <h3 class="text-2xl font-semibold mt-6 text-gray-800 flex items-center space-x-2 border-b pb-2">
                <script>document.write(renderIcon('database', 'w-6 h-6 text-yellow-600'));</script>
                <span>Step 10: Post-Processing: Update Google Sheets Status (Closing the Loop)</span>
            </h3>
            <p class="mt-3 text-gray-700 leading-relaxed">
                ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Flow ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (Path A, B, C) ‡∏ó‡∏∏‡∏Å Item ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏£‡∏ß‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà **Merge Node** ‡πÅ‡∏•‡∏∞‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á <code class="expression-code">Leads</code> ‡∏Ç‡∏≠‡∏á Google Sheets
            </p>
            <pre class="text-sm">
// Google Sheets Node: Update Row (‡πÉ‡∏ä‡πâ 'Update Row' Method)
Sheet: <code class="expression-code">Leads</code>
Key Column: <code class="expression-code">Lead ID</code>
Key Value: <code class="expression-code">{{ $json.transaction_id }}</code> // ‡πÉ‡∏ä‡πâ Transaction ID ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å AppSheet

Data to Update:
| Column | Value |
|:---|:---|
| <code class="expression-code">N8N_Status</code> | <code class="expression-code">PROCESSED - TIER {{ $node['AI Node'].json['tier'] }}</code> |
| <code class="expression-code">AI_Score</code> | <code class="expression-code">{{ $node['AI Node'].json['score'] }}</code> |
| <code class="expression-code">Sales_Rep</code> | <code class="expression-code">{{ $json.assigned_email }}</code> |
| <code class="expression-code">Processed_Date</code> | <code class="expression-code">{{ NOW() }}</code> |
            </pre>
            <p class="text-gray-700 leading-relaxed mt-3">
                ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ **AppSheet Dashboard** ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á Leads ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÇ‡∏î‡∏¢ N8N ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Synchronization)
            </p>

            <!-- Step 6.5.3: Final Production Check -->
            <div class="section-header border-blue-500 mb-6 mt-8">
                <h3 class="2xl font-bold gradient-text">6.5.3 Production Check ‡πÅ‡∏•‡∏∞ Monitoring (Day 4 Integration)</h3>
            </div>
            <p class="text-gray-700 leading-relaxed mb-4">
                ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Flow ‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å Test Mode ‡πÄ‡∏õ‡πá‡∏ô Production (Active) ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 3 ‡∏à‡∏∏‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢:
            </p>
            <ol class="list-decimal list-inside ml-4 mt-2 space-y-2 text-gray-700">
                <li>**Monitoring:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ **Error Workflow** (Catch-All) ‡πÅ‡∏•‡∏∞ **DLQ** ‡∏Ç‡∏≠‡∏á Flow ‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (Day 4: Step 14)</li>
                <li>**Credentials:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ API Keys ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (CRM, Gemini, Slack) ‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å **Environment Variables** ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Hardcode (Day 4: Step 16)</li>
                <li>**Rate Limiting:** ‡∏´‡∏≤‡∏Å CRM API ‡∏°‡∏µ Rate Limit ‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≥ ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° **Delay Node** ‡∏Å‡πà‡∏≠‡∏ô API Call ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ **Queue Node** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏¢‡∏¥‡∏á API ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ</li>
            </ol>
            
            <h4 class="text-xl font-medium mt-6 text-indigo-700">‡πÇ‡∏Ñ‡πâ‡∏î: ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Rate Limit ‡∏î‡πâ‡∏ß‡∏¢ Delay Node</h4>
            <pre class="text-sm">
// ‡∏£‡∏∞‡∏ö‡∏∏ Delay ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á HTTP Request Node ‡πÑ‡∏õ‡∏¢‡∏±‡∏á CRM API
Delay Time: <code class="expression-code">6000</code> milliseconds // 6 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏¢‡∏¥‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ)
Delay Time per Item: <code class="expression-code">Yes</code> // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞ Item ‡∏ñ‡∏π‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô
            </pre>
            
            <div class="highlight-card p-4 rounded-lg my-4">
                <h4 class="font-bold text-emerald-800">‚úÖ Master Project Complete: ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô End-to-End</h4>
                <p class="text-emerald-700 text-sm mt-1">
                    MVP ‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏û‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á Low-Code (AppSheet) ‡πÅ‡∏•‡∏∞ No-Code Automation (N8N) ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢ AI ‡πÅ‡∏•‡∏∞ Logic ‡∏£‡∏∞‡∏î‡∏±‡∏ö Production (Resilience) ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡πÉ‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£ Master Handbook ‡∏Ñ‡∏£‡∏±‡∏ö
                </p>
            </div>
        </div>

        <!-- *************************************************************** -->
        <!-- FINAL CHECKLIST & CONCLUSION -->
        <!-- *************************************************************** -->
        <hr class="my-6 border-t border-gray-200">

        <!-- ‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ Day 5 (Updated Checklist) -->
        <div class="bg-white p-6 rounded-xl card-shadow mt-8">
            <div class="section-header border-green-500">
                <h2 class="text-3xl font-bold" style="color: #10b981;">
                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                    ‡∏™‡∏£‡∏∏‡∏õ Day 5: Final Project Master Checklist
                </h2>
            </div>
            
            <div class="mt-4 p-6 bg-green-50 rounded-xl card-shadow">
                <p class="text-green-800 font-semibold mb-3">Master Project ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</p>
                <ul class="list-disc list-inside space-y-3 text-gray-700 ml-4">
                    <li>‚úÖ **Synthesis:** ‡∏£‡∏ß‡∏° Data Design, AppSheet UX, N8N Flow, AI ‡πÅ‡∏•‡∏∞ Resilience</li>
                    <li>‚úÖ **Pre-Processing Master:** Data Validation ‡πÅ‡∏•‡∏∞ Correlation ID ‡πÉ‡∏ô Code Node</li>
                    <li>‚úÖ **Asynchronous Handling:** ‡πÉ‡∏ä‡πâ Controller Flow + Worker Flow ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô (HTTP 202)</li>
                    <li>‚úÖ **AI Decision:** ‡πÉ‡∏ä‡πâ Gemini LLM Node ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **Structured Lead Scoring** (Priority/Tier)</li>
                    <li>‚úÖ **Resilience:** ‡πÉ‡∏ä‡πâ **Exponential Backoff** ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ **DLQ Worker** ‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</li>
                    <li>‚úÖ **Advanced Code:** ‡πÉ‡∏ä‡πâ **Dynamic HTML Templating** ‡πÅ‡∏•‡∏∞ **A/B Testing Logic**</li>
                    <li>‚úÖ **Closing the Loop:** **Post-Processing** ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Leads ‡πÉ‡∏ô Google Sheets</li>
                    <li>‚úÖ **Production Readiness:** ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Rate Limiting ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Environment Variables</li>
                </ul>
            </div>
        </div>
        
    </main>

    <!-- Footer Section (Consistent with Master Handbook - Tailwind Structure) -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p>&copy; 2025 AI Automation & Data Integration Master. | ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÇ‡∏î‡∏¢ ‡∏≠.‡πÅ‡∏ó‡∏ô [‡∏ò‡∏µ‡∏£‡∏ä‡∏±‡∏¢ ‡πÇ‡∏â‡∏°‡∏ó‡∏±‡∏û]</p>
            <p class="text-sm text-gray-400 mt-1">Head of Digital Transformation</p>
        </div>
    </footer>

</body>
</html>
