<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบที่ 4: AI Data Pipeline & Dashboard</title>
    <!-- โหลด Tailwind CSS และ Lucide Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
            line-height: 1.7;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background-color: white;
            padding: 40px;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        /* Gradient Header (ใช้สีเหลือง-ส้ม สำหรับ Analytics/Insight) */
        .gradient-header {
            background-image: linear-gradient(90deg, #fcd34d, #f97316); /* Amber to Orange */
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }
        /* Step Box (จำลองภาพประกอบการทำงาน) */
        .step-box {
            border-left: 4px solid #f97316; /* Orange */
            padding-left: 1rem;
            margin-bottom: 2rem;
        }
        /* Flowchart Components (ใช้ CSS สร้าง Diagram แทนรูปภาพ) */
        .flow-node {
            padding: 12px 20px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            margin: 10px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .node-trigger { background-color: #f59e0b; color: white; } /* Amber for Trigger */
        .node-script { background-color: #10b981; color: white; } /* Emerald for GAS/AppScript */
        .node-db { background-color: #3b82f6; color: white; } /* Blue for Database (GGS) */
        .node-action { background-color: #6366f1; color: white; } /* Indigo for Dashboard/AppSheet */
        .flow-arrow {
            text-align: center;
            font-size: 1.5rem;
            color: #9ca3af;
            margin: 5px 0;
        }
        .setup-guide-item {
            padding: 1.5rem;
            background-color: #fffbeb; /* Light Yellow */
            border: 1px solid #fde68a; /* Light Yellow Border */
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .setup-guide-item h4 {
            color: #b45309; /* Dark Orange */
        }
        .code-detail {
            background-color: #27272a; /* Zinc 800 */
            color: #f4f4f5; /* Zinc 50 */
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            overflow-x: auto;
            margin-top: 0.75rem;
            font-size: 0.85rem;
            white-space: pre-wrap; /* เพื่อให้โค้ดแสดงผลได้ดีขึ้น */
        }
        .code-detail strong {
            color: #fcd34d; /* Amber 300 */
        }
        .detail-step {
            margin-top: 15px;
            margin-bottom: 15px;
            border-left: 3px solid #f97316; /* Orange */
            padding-left: 15px;
        }
        .detail-step strong {
            color: #f97316;
        }
        .instruction-list li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="container">

        <!-- ส่วนหัว: รูปโปรไฟล์และชื่ออาจารย์ -->
        <header class="text-center mb-10">
            <div class="flex flex-col items-center">
                <img 
                    src="https://profile.line-scdn.net/0h0eGDNw66b0pqPX4GcyERNRptbCBJTDZYT190LFluMi9eCyscRwgpL1g_OHpWCHhIEghzeAhqYnNmLhgsdGuTfm0NMntWCy0aQ14hrA" 
                    alt="รูปโปรไฟล์ อ.แทน" 
                    class="w-20 h-20 object-cover rounded-full ring-4 ring-orange-500 shadow-xl mb-3"
                    onerror="this.onerror=null; this.src='https://placehold.co/80x80/f97316/ffffff?text=อ.แทน'"
                >
                <h1 class="text-3xl font-extrabold text-gray-800 tracking-tight">
                    อ.แทน <span class="text-orange-600">[ธีรชัย โฉมทัพ]</span>
                </h1>
                <p class="text-lg text-gray-500 mt-1">AI Automation Instructor</p>
            </div>
        </header>
        
        <!-- หัวข้อหลักและหัวข้อย่อย -->
        <h2 class="text-4xl sm:text-5xl mb-6">
            <span class="gradient-header">
                ระบบที่ 4: Data Pipeline & Dashboard (Line OA Analytics ครบวงจร)
            </span>
        </h2>
        <p class="text-xl text-gray-600 mb-8">
            สร้าง Data Pipeline ครบวงจร: **Line OA → GGS/GAS → AppSheet/Looker Studio** เพื่อรวบรวม วิเคราะห์ และแสดงผลพฤติกรรมลูกค้าสำหรับการตัดสินใจทางธุรกิจ
        </p>

        <!-- 1. บทนำ, 2. วัตถุประสงค์หลัก, 3. เครื่องมือที่ใช้ (เหมือนเดิม) -->
        <section class="mb-10 p-6 bg-yellow-50 rounded-xl shadow-lg">
            <h3 class="text-2xl font-bold text-yellow-700 flex items-center mb-4"><i data-lucide="info" class="w-6 h-6 mr-2"></i>1. บทนำ: การตัดสินใจที่ขับเคลื่อนด้วยข้อมูล (Data-Driven Decision)</h3>
            <p class="text-gray-700">ระบบนี้ใช้ **Google Apps Script (GAS)** เป็น Core Engine ในการจัดการข้อมูลทั้งหมด โดยรับข้อมูลพฤติกรรมการมีส่วนร่วม (Engagement) จาก Line OA มาจัดเก็บใน GGS จากนั้น GAS จะประมวลผลข้อมูลดิบให้เป็น Metrics ที่สะอาด เพื่อแสดงผลใน **Looker Studio** และให้ทีมงานดูข้อมูล/กรอกข้อมูลเสริมผ่าน **AppSheet** ทำให้ SME สามารถวัดผลแคมเปญได้อย่างแม่นยำ (MM)</p>
        </section>

        <section class="mb-10">
            <h3 class="text-2xl font-bold text-gray-700 flex items-center mb-4"><i data-lucide="target" class="w-6 h-6 mr-2 text-red-500"></i>2. วัตถุประสงค์หลัก (Object of Expenditure)</h3>
            <div class="grid grid-cols-2 gap-4 text-gray-700">
                <div class="p-3 bg-red-100 rounded-lg shadow-md flex items-center"><i data-lucide="trending-up" class="w-5 h-5 mr-2 text-red-600"></i><span class="font-bold">MM:</span> เพิ่ม Conversion Rate ด้วย Insight ที่แม่นยำ</div>
                <div class="p-3 bg-red-100 rounded-lg shadow-md flex items-center"><i data-lucide="brain" class="w-5 h-5 mr-2 text-red-600"></i><span class="font-bold">BH:</span> ลดความเครียดจากการตัดสินใจโดยไม่มีข้อมูล</div>
                <div class="p-3 bg-red-100 rounded-lg shadow-md flex items-center"><i data-lucide="clock" class="w-5 h-5 mr-2 text-red-600"></i><span class="font-bold">ST:</span> ลดเวลาในการจัดทำรายงานและสรุปข้อมูลด้วยคน</div>
                <div class="p-3 bg-red-100 rounded-lg shadow-md flex items-center"><i data-lucide="activity" class="w-5 h-5 mr-2 text-red-600"></i><span class="font-bold">AE:</span> การจัดระเบียบข้อมูลดิบและคำนวณ Metrics อัตโนมัติด้วย GAS</div>
            </div>
        </section>

        <section class="mb-10 p-6 bg-gray-100 rounded-xl shadow-lg">
            <h3 class="text-2xl font-bold text-gray-700 flex items-center mb-4"><i data-lucide="wrench" class="w-6 h-6 mr-2 text-orange-500"></i>3. เครื่องมือที่ใช้ (Technology Stack)</h3>
            <ul class="space-y-3 text-gray-700 list-disc list-inside">
                <li>**Line OA:** แหล่งข้อมูลหลัก (User Interactions)</li>
                <li>**GGS (Google Sheets):** Data Warehouse ในการเก็บ Raw Data และ Processed Data</li>
                <li>**GAS (Google Apps Script):** **Core Automation Engine** ใช้ในการเขียน Logic, Clean Data และรับ Webhook โดยตรง</li>
                <li>**AppSheet:** **User Interface** สำหรับทีมงานในการดูข้อมูลสรุป หรือกรอกข้อมูลเสริม</li>
                <li>**Looker Studio:** เครื่องมือสร้าง Dashboard และ Visualization เชิงลึก</li>
            </ul>
        </section>

        <!-- 4. รายละเอียดการดำเนินการ (Step-by-Step Implementation Guide) -->
        <section class="mb-10">
            <h3 class="text-3xl font-bold text-gray-800 flex items-center mb-6 border-b pb-2">
                <i data-lucide="list-checks" class="w-7 h-7 mr-2 text-yellow-500"></i>
                4. รายละเอียดการดำเนินการ: คู่มือ Step-by-Step (Workflow)
            </h3>
            
            <!-- 4.1 แผนผังการทำงานโดยรวม (Flowchart Visualization) (เหมือนเดิม) -->
            <div class="mb-8 p-6 bg-yellow-50 rounded-xl shadow-inner">
                <h4 class="text-xl font-bold text-yellow-700 mb-4">4.1 แผนผังการทำงาน (System Flowchart - HTML/CSS Diagram)</h4>
                <div class="flex flex-col items-center">
                    <div class="flow-node node-trigger w-3/4">1. ลูกค้าคลิก/ส่งข้อความ (Line OA Webhook Event)</div>
                    <div class="flow-arrow">👇</div>
                    <div class="flow-node node-script w-3/4">2. GAS Webhook Handler: บันทึก Raw Event Data ลง GGS (Raw Data Sheet)</div>
                    <div class="flow-arrow">👇</div>
                    <div class="flow-node node-script w-3/4">3. GAS Scheduler: รัน Script ประมวลผล (Clean, Calculate Metrics)</div>
                    <div class="flow-arrow">👇</div>
                    <div class="flow-node node-db w-3/4">4. GAS: บันทึกผลลัพธ์ที่ประมวลผลแล้วลง GGS (Processed Data Sheet)</div>
                    <div class="flow-arrow"> bifurcates... </div>
                    
                    <div class="grid grid-cols-2 gap-4 w-full mt-4">
                        <div class="col-span-1 flex flex-col items-center"><div class="flow-node node-action w-full bg-indigo-400">5a. Looker Studio: ดึง Processed Data มาแสดงผล</div></div>
                        <div class="col-span-1 flex flex-col items-center"><div class="flow-node node-action w-full bg-indigo-600">5b. AppSheet: ดึง Processed Data มาแสดงผล/เป็น Input Interface</div></div>
                    </div>
                </div>
            </div>

            <div class="space-y-10">
                <h4 class="text-2xl font-bold text-orange-600 mb-6">⚙️ Workflow: Data Pipeline (GAS Core)</h4>

                <!-- Step 1: Line OA Webhook Trigger & GGS Setup -->
                <div class="step-box">
                    <h4 class="text-xl font-bold text-gray-800 flex items-center mb-3"><i data-lucide="check-circle" class="w-5 h-5 mr-2 text-orange-500"></i> Step 1: Line OA Event -> GGS Setup (พร้อมคอลัมน์)</h4>
                    <p>**1.1 GGS Setup:** สร้าง Google Sheet ชื่อ **"Line OA Analytics Master"** (มี 2 Sheet ย่อย)</p>
                    <p class="mt-2 font-bold text-gray-700"> Sheet 1: **Raw Data** (สำหรับ Webhook Handler)</p>
                    <ul class="list-disc list-inside ml-4 text-gray-700">
                        <li>**A: Timestamp** (วันที่และเวลาที่รับ Event)</li>
                        <li>**B: Raw_JSON** (JSON ดิบจาก Line OA)</li>
                    </ul>
                    <p class="mt-4 font-bold text-gray-700"> Sheet 2: **Processed Data** (สำหรับ AppSheet/Looker Studio)</p>
                    <ul class="list-disc list-inside ml-4 text-gray-700">
                        <li>**A: Date_Key** (วันที่ประมวลผล)</li>
                        <li>**B: Event_Type** (เช่น Message, Click, Follow)</li>
                        <li>**C: User_ID**</li>
                        <li>**D: Total_Count** (จำนวน Event)</li>
                        <li>**E: Dimension_Value** (เช่น Rich Menu ID, Message Text)</li>
                    </ul>
                    <p>**1.2 GAS Webhook:** ใช้ฟังก์ชัน **`doPost(e)`** ใน Google Apps Script เพื่อรับ Webhook Event (ดูโค้ดเต็มใน Setup Guide 5.1)</p>
                </div>

                <!-- Step 2: GAS Script for Data Transformation (Core Logic) -->
                <div class="step-box">
                    <h4 class="text-xl font-bold text-gray-800 flex items-center mb-3"><i data-lucide="check-circle" class="w-5 h-5 mr-2 text-orange-500"></i> Step 2: GAS Script: Data Cleaning & Metric Calculation</h4>
                    <p>**2.1 Script Code (`processRawData`):** เขียน Logic ใน GAS เพื่อดึง Raw Data, แยก Event Type, และนับความถี่เพื่อคำนวณ Metrics</p>
                    <div class="code-detail bg-green-900">
                        // ฟังก์ชันนี้จะดึง Raw Data มาประมวลผลและคำนวณ Metrics<br>
                        function processRawData() {<br>
                        &nbsp;&nbsp;const ss = SpreadsheetApp.getActiveSpreadsheet();<br>
                        &nbsp;&nbsp;const rawSheet = ss.getSheetByName("Raw Data");<br>
                        &nbsp;&nbsp;const processedSheet = ss.getSheetByName("Processed Data");<br>
                        &nbsp;&nbsp;const rawData = rawSheet.getDataRange().getValues();<br>
                        &nbsp;&nbsp;rawData.shift(); // ลบ Header<br>
                        <br>
                        &nbsp;&nbsp;let metrics = {};<br>
                        &nbsp;&nbsp;const today = Utilities.formatDate(new Date(), ss.getSpreadsheetTimeZone(), "yyyy-MM-dd");<br>
                        <br>
                        &nbsp;&nbsp;// **Logic Core:** Loop เพื่อวิเคราะห์ Event แต่ละรายการ<br>
                        &nbsp;&nbsp;rawData.forEach(row => {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;const jsonString = row[1]; // Column B (Raw_JSON)<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const data = JSON.parse(jsonString);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data.events && data.events.length > 0) {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.events.forEach(event => {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const eventType = event.type;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const userId = event.source.userId || 'N/A';<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// **Metric 1: Count By Event Type**<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;metrics[`${today}_${eventType}`] = (metrics[`${today}_${eventType}`] || 0) + 1;<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;} catch (e) {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Logger.log("Error parsing JSON: " + e);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                        &nbsp;&nbsp;});<br>
                        <br>
                        &nbsp;&nbsp;// **Save Processed Data**<br>
                        &nbsp;&nbsp;for (const key in metrics) {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;const [date, type] = key.split('_');<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;processedSheet.appendRow([date, type, 'N/A', metrics[key], 'TOTAL']);<br>
                        &nbsp;&nbsp;}<br>
                        &nbsp;&nbsp;// **เคลียร์ Raw Data** เพื่อป้องกันการประมวลผลซ้ำ (Optional: rawSheet.clearContents())<br>
                        }<br>
                    </div>
                    <p class="mt-2 text-gray-700">
                        **เป้าหมาย:** โค้ดนี้จะ Loop ข้อมูล JSON ดิบ (Raw JSON) และนับจำนวน Event แต่ละประเภท (Message, Follow, Unfollow, Click) เพื่อบันทึกเป็น Row ในชีต **Processed Data**
                    </p>
                </div>

                <!-- Step 3: GAS Scheduler & Execution (เหมือนเดิม) -->
                <div class="step-box">
                    <h4 class="text-xl font-bold text-gray-800 flex items-center mb-3"><i data-lucide="check-circle" class="w-5 h-5 mr-2 text-orange-500"></i> Step 3: GAS Trigger: ตั้งเวลาประมวลผลอัตโนมัติ</h4>
                    <p>**3.1 GAS Trigger Setup:** ใน Google Apps Script ไปที่เมนู **Triggers (รูปนาฬิกา)**</p>
                    <div class="code-detail">
                        **Function:** เลือก `processRawData`<br>
                        **Event Source:** Time-driven<br>
                        **Type:** Day timer (เลือกเวลาที่เหมาะสม เช่น รันทุกเช้าตรู่)
                    </div>
                    <p class="mt-2 text-gray-700">
                        **เป้าหมาย:** ทำให้ Data Pipeline ทำงานโดยอัตโนมัติ (AE, ST)
                    </p>
                </div>

                <!-- Step 4a: Looker Studio Dashboard Setup (เหมือนเดิม) -->
                <!-- Step 4b: AppSheet Interface Setup (เหมือนเดิม) -->
                <div class="step-box ml-8 bg-gray-100 p-4 rounded-lg">
                    <h5 class="text-xl font-bold text-indigo-600 mb-2 flex items-center"><i data-lucide="app-window" class="w-5 h-5 mr-2"></i> Step 4b: AppSheet Interface & Input</h5>
                    <p>**4b.1 Data Source:** สร้าง App ใหม่ใน AppSheet โดยเชื่อมกับ **Processed Data Sheet**</p>
                    <p>**4b.2 User Interface:** ใช้ AppSheet เป็น View เพื่อให้ทีมงานดูข้อมูลสรุปแบบง่ายๆ บนมือถือ หรือสร้าง Form สำหรับกรอกข้อมูลเสริม (เช่น งบประมาณแคมเปญ) ซึ่งข้อมูลนี้จะถูกบันทึกกลับไปที่ GGS</p>
                </div>
            </div>
            
            <!-- 5. คู่มือการเตรียมเครื่องมือเบื้องต้น (Setup Guide) - เพิ่มโค้ดที่ 2 -->
            <section class="mt-10 p-6 bg-red-50 rounded-xl shadow-md">
                <h3 class="text-2xl font-bold text-red-700 flex items-center mb-6">
                    <i data-lucide="clipboard-list" class="w-6 h-6 mr-2"></i>
                    5. คู่มือการเตรียมเครื่องมือเบื้องต้น (Setup Guide) **[GAS 100%]**
                </h3>
                <p class="text-gray-700 mb-6">
                    ขั้นตอนเหล่านี้เน้นการใช้ Google Apps Script (GAS) เป็น Webhook Receiver และ Scheduler โดยตรง
                </p>

                <!-- Item 1: GGS & Script Setup -->
                <div class="setup-guide-item">
                    <h4 class="text-xl font-bold flex items-center mb-3">
                        <i data-lucide="sheet" class="w-5 h-5 mr-2 text-amber-600"></i>
                        1. เตรียม Google Sheet (GGS) และ Google Apps Script (GAS) Webhook
                    </h4>
                    <div class="detail-step">
                        <strong>ขั้นตอนที่ 1.1: สร้าง GGS และ Sheet พร้อมคอลัมน์</strong>
                        <ul class="list-decimal list-inside ml-4 instruction-list text-gray-700">
                            <li>สร้าง GGS ชื่อ **"Line OA Analytics Master"** มี 2 Sheets: **Raw Data** (คอลัมน์ A: Timestamp, B: Raw\_JSON) และ **Processed Data** (คอลัมน์ A: Date\_Key, B: Event\_Type, C: User\_ID, D: Total\_Count, E: Dimension\_Value)</li>
                        </ul>
                    </div>
                    <div class="detail-step">
                        <strong>ขั้นตอนที่ 1.2: คัดลอกโค้ด Webhook Handler (`doPost`)</strong>
                        <ul class="list-decimal list-inside ml-4 instruction-list text-gray-700">
                            <li>ใน GGS ไปที่ **Extensions > Apps Script** คัดลอกโค้ดนี้เพื่อสร้างฟังก์ชันรับ Webhook</li>
                        </ul>
                        <div class="code-detail bg-emerald-900">
                            // โค้ด: Webhook Receiver - รับ JSON ดิบจาก Line OA และบันทึกในชีต Raw Data<br>
                            function doPost(e) {<br>
                            &nbsp;&nbsp;const ss = SpreadsheetApp.getActiveSpreadsheet();<br>
                            &nbsp;&nbsp;const rawSheet = ss.getSheetByName('Raw Data');<br>
                            &nbsp;&nbsp;const data = JSON.parse(e.postData.contents);<br>
                            &nbsp;&nbsp;rawSheet.appendRow([new Date(), JSON.stringify(data)]);<br>
                            &nbsp;&nbsp;return ContentService.createTextOutput(JSON.stringify({'status': 'ok'}));<br>
                            }<br>
                        </div>
                    </div>
                    <div class="detail-step">
                        <strong>ขั้นตอนที่ 1.3: คัดลอกโค้ด Data Processor (`processRawData`)</strong>
                        <ul class="list-decimal list-inside ml-4 instruction-list text-gray-700">
                            <li>ใน GAS เดียวกัน คัดลอกโค้ดนี้สำหรับประมวลผลข้อมูล (Step 2.1)</li>
                        </ul>
                        <div class="code-detail bg-emerald-900">
                            // โค้ด: Data Processor - ประมวลผล Raw JSON และบันทึก Metrics ในชีต Processed Data<br>
                            function processRawData() {<br>
                            &nbsp;&nbsp;const ss = SpreadsheetApp.getActiveSpreadsheet();<br>
                            &nbsp;&nbsp;const rawSheet = ss.getSheetByName("Raw Data");<br>
                            &nbsp;&nbsp;const processedSheet = ss.getSheetByName("Processed Data");<br>
                            &nbsp;&nbsp;const rawData = rawSheet.getDataRange().getValues();<br>
                            &nbsp;&nbsp;rawData.shift(); // Remove header<br>
                            &nbsp;&nbsp;let metrics = {};<br>
                            &nbsp;&nbsp;const today = Utilities.formatDate(new Date(), ss.getSpreadsheetTimeZone(), "yyyy-MM-dd");<br>
                            <br>
                            &nbsp;&nbsp;rawData.forEach(row => {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;const jsonString = row[1];<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const data = JSON.parse(jsonString);<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data.events && data.events.length > 0) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.events.forEach(event => {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const eventType = event.type;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;metrics[`${today}_${eventType}`] = (metrics[`${today}_${eventType}`] || 0) + 1;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;} catch (e) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Logger.log("Error parsing JSON: " + e);<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                            &nbsp;&nbsp;});<br>
                            <br>
                            &nbsp;&nbsp;// Save Processed Data<br>
                            &nbsp;&nbsp;for (const key in metrics) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;const [date, type] = key.split('_');<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;processedSheet.appendRow([date, type, 'N/A', metrics[key], 'TOTAL']); // (Date, Type, UserID, Count, Dimension)<br>
                            &nbsp;&nbsp;}<br>
                            }<br>
                        </div>
                    </div>
                    <div class="detail-step">
                        <strong>ขั้นตอนที่ 1.4: Deploy GAS Webhook และรับ URL</strong>
                        <ul class="list-decimal list-inside ml-4 instruction-list text-gray-700">
                            <li>ใน GAS คลิก **Deploy > New Deployment** เลือก Type เป็น **Web app**</li>
                            <li>กด Deploy แล้ว **คัดลอก Web app URL** ที่ได้มาเก็บไว้ (ใช้ใน Line OA)</li>
                        </ul>
                    </div>
                </div>

                <!-- Item 2: Line OA Webhook URL & AppSheet Setup (เหมือนเดิม) -->
                <div class="setup-guide-item">
                    <h4 class="text-xl font-bold flex items-center mb-3">
                        <i data-lucide="message-square" class="w-5 h-5 mr-2 text-amber-600"></i>
                        2. Line OA Webhook และ AppSheet Connection
                    </h4>
                    <div class="detail-step">
                        <strong>ขั้นตอนที่ 2.1: เชื่อมต่อ Line OA กับ GAS</strong>
                        <ul class="list-decimal list-inside ml-4 instruction-list text-gray-700">
                            <li>ไปที่ **Line Developer Console** วาง **Web app URL** (จาก GAS) ลงในช่อง **Webhook URL** และ **Enable Webhook**</li>
                        </ul>
                    </div>
                    <div class="detail-step">
                        <strong>ขั้นตอนที่ 2.2: เชื่อมต่อ AppSheet</strong>
                        <ul class="list-decimal list-inside ml-4 instruction-list text-gray-700">
                            <li>ไปที่ <a href="https://www.appsheet.com/" target="_blank" class="text-blue-500 hover:underline">AppSheet</a> สร้าง App ใหม่โดยใช้ GGS **"Line OA Analytics Master"** (Processed Data Sheet) เป็น **Data Source**</li>
                        </ul>
                    </div>
                </div>

                <!-- Item 3: Looker Studio Connection & Trigger Setup (เหมือนเดิม) -->
                <div class="setup-guide-item">
                    <h4 class="text-xl font-bold flex items-center mb-3">
                        <i data-lucide="bar-chart-3" class="w-5 h-5 mr-2 text-amber-600"></i>
                        3. Looker Studio และ GAS Trigger Setup
                    </h4>
                    <div class="detail-step">
                        <strong>ขั้นตอนที่ 3.1: ตั้งเวลาประมวลผลข้อมูล (GAS Trigger)</strong>
                        <ul class="list-decimal list-inside ml-4 instruction-list text-gray-700">
                            <li>ใน GAS ไปที่เมนู **Triggers** และตั้งค่าให้ฟังก์ชัน `processRawData` รันตามเวลาที่กำหนด (Time-driven)</li>
                        </ul>
                    </div>
                    <div class="detail-step">
                        <strong>ขั้นตอนที่ 3.2: สร้าง Dashboard ใน Looker Studio</strong>
                        <ul class="list-decimal list-inside ml-4 instruction-list text-gray-700">
                            <li>ไปที่ <a href="https://lookerstudio.google.com/" target="_blank" class="text-blue-500 hover:underline">Looker Studio</a> เลือก Data Source เป็น **Google Sheets** และเลือก Sheet **"Processed Data"**</li>
                        </ul>
                    </div>
                </div>

                <div class="mt-6 flex justify-center">
                    <button class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg hover:bg-indigo-700 transition duration-300 flex items-center">
                        <i data-lucide="calendar" class="w-5 h-5 mr-2"></i>
                        Add to Calendar: เริ่มต้นหลักสูตร
                    </button>
                </div>
            </section>

            <!-- Footer for Navigation -->
            <footer class="mt-12 pt-6 border-t border-gray-200 flex justify-between">
                <a href="system03-content-broadcast.html" class="text-blue-500 hover:text-blue-700 flex items-center">
                    <i data-lucide="arrow-left" class="w-5 h-5 mr-1"></i>
                    ย้อนกลับ ระบบที่ 3
                </a>
                <a href="aiautomation-index.html" class="text-blue-500 hover:text-blue-700 flex items-center">
                    จบหลักสูตร: กลับหน้าดัชนี
                    <i data-lucide="arrow-right" class="w-5 h-5 ml-1"></i>
                </a>
            </footer>

        </section>
        
    </div>

    <!-- Script เพื่อให้ Lucide Icons แสดงผล -->
    <script>
        lucide.createIcons();
        document.querySelector('button').addEventListener('click', () => {
            alert('ฟังก์ชันนี้ใช้สำหรับเพิ่มกิจกรรมลงในปฏิทินเมื่อมีการเผยแพร่จริง');
        });
    </script>

</body>
</html>
